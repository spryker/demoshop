{% form_theme form.billing_address '@checkout/checkout/theme.twig' %}
{% form_theme form.shipping_address '@checkout/checkout/theme.twig' %}
{% form_theme form '@checkout/checkout/theme.twig' %}


{% block content %}
    <!-- TODO: split up huge file -->
    {% if cart.items|length > 0 %}

        <section id="backend-errors-section" class="checkout__form-block" style="display:none;">
            <h1 class="form-block__heading">{{ "page.checkout.errors" | trans }}</h1>
            <div id="backend-errors"></div>
        </section>

        <section class="checkout__form-block checkout__form-block--login js-checkout-login">
            {% if app.user is null %}
                <input type="hidden" name="mode" value="guest" />

                {% include "@application/layout/content/checkout/login-form.twig" %}
            {% endif %}
        </section>





        <form class="checkout js-formbackup" data-formbackup="checkout" method="POST" {% if app.user is null %}style="display: none;"{% endif %}>

            <div class="checkout__headline">
                Bestellung abschließen
            </div>

            <div class="checkout__navigations">
                <div class="checkout__navigation">1 Adresse</div>
                <div class="checkout__navigation">2 Zahlart</div>
                <div class="checkout__navigation">3 Bestätigung</div>
            </div>

            <div class="checkout__contents">


                {{ form_start(form, {'attr': {'id': 'adyen-encrypted-form'}}) }}

                <section class="checkout__content checkout__content--account">

                    <div class="checkout__step-headline">Adresse</div>

                    <div id="invoice-address" class="checkout__form">
                        {{ form_widget(form.email) }}
                        {{ form_widget(form.billing_address) }}

                        <input type="hidden" id="addShipmentFee" value="{{ url('checkout/get-shipment-fee') }}">

                        {% include '@application/layout/common/forms/checkbox.twig' with {
                            name: 'different-delivery-address',
                            id: 'different-delivery-address',
                            label: ('page.checkout.address.billing-isnt-shipping-address' | trans),
                            value: ''
                        } %}

                        <div class="checkout__subform">
                            <div class="checkout__subform-inner">
                                {{ form_widget(form.shipping_address) }}
                            </div>
                        </div>

                        <button type="button" class="button button--cta checkout__step-button">
                            {{ 'Weiter zu Zahlarten' }}
                        </button>

                    </div>

                </section>


                <section class="checkout__content checkout__content--account">

                    <div class="checkout__step-headline">Zahlart</div>

                    <div class="checkout__form checkout__form--payment">

                        {% for payment_method in form.adyen_payment.payment_method %}

                            {{ form_widget(payment_method) }}
                            {{ form_label(payment_method) }}
                            {{ form_errors(payment_method) }}

                                {% if payment_method.vars.value == 'adyen.payment.method.sepa.directdebit' %}
                                    <div id="form_rechnung" class="checkout__subform checkout__subform--sepa">
                                        <div class="checkout__subform-inner">
                                            {{ form_widget(form.adyen_payment.payment_detail.ownerName) }}
                                            {{ form_widget(form.adyen_payment.payment_detail.bank_account_number) }}
                                            {{ form_widget(form.adyen_payment.payment_detail.bank_location_id) }}
                                        </div>
                                    </div>

                                {% elseif payment_method.vars.value == 'adyen.payment.method.paypal' %}

                                {% elseif payment_method.vars.value == 'adyen.payment.method.creditcard.cse' %}
                                    <div id="form_rechnung" class="checkout__subform checkout__subform--creditcard">
                                        <div class="checkout__subform-inner">
                                            {{ form_widget(form.adyen_payment.payment_detail.adyen_encrypted_form_number) }}
                                            {{ form_widget(form.adyen_payment.payment_detail.adyen_encrypted_form_cvc) }}
                                            {{ form_widget(form.adyen_payment.payment_detail.adyen_encrypted_form_holder_name) }}

                                            <div class="input-validity">
                                                <label class="input__label" for="validity_month">Gültigkeit</label>

                                                {{ form_widget(form.adyen_payment.payment_detail.adyen_encrypted_form_expiry_month) }}

                                                <span class="input-validity__separator">/</span>

                                                {{ form_widget(form.adyen_payment.payment_detail.adyen_encrypted_form_expiry_year) }}

                                                <div class="checkout__lock">Secure Connection</div>
                                            </div>
                                        </div>
                                    </div>

                                {% elseif payment_method.vars.value == 'adyen.payment.method.german.bank.transfer' %}

                                {% endif %}

                        {% endfor %}

                        <button type="button" class="button button--cta checkout__step-button">
                            {{ 'Weiter zur Bestellbestätigung' }}
                        </button>

                    </div>
                </section>


                <section class="checkout__content checkout__content--confirmation">

                    <div class="checkout__step-headline">Adresse</div>

                    <div class="checkout__cart">
                        {% include "@checkout/checkout/cartWithCouponTextfield.twig" %}
                    </div>

                    <div class="checkout__terms">
                        {{ form_widget(form.newsletter) }}
                        {{ form_widget(form.terms) }}
                    </div>

                    <button type="submit" class="button button--cta checkout__step-button">
                        {{ 'Jetzt kaufen' }}
                    </button>

                    <div class="checkout__terms-info">
                        Mit Ihrer Bestellung erklären Sie sich mit unseren AGB, Datenschutzbestimmungen und Widerrufsbestimmungen einverstanden. <br>
                        Als Kunde von PETS DELI erhalten Sie Produktempfehlungen per Mail. Sie können jederzeit unter office@petsdeli.de, unserer Hotline 030 - 208 98 48 99 oder dem Abmeldelink in jeder Produktempfehlungsmail widersprechen. <br>
                        Es entstehen Ihnen keine höheren Kosten als die nach den Basistarifen.
                    </div>
                </section>

                {{ form_end(form) }}

            </div>
        </div>


    {% else %}


        <article class="product product--justice-league">
            <section class="product__overview">
                <h2 class="product__name">{{ 'cart.empty'|trans }}</h2>
            </section>
        </article>

    {% endif %}

{% endblock %}

<!-- [Hack] @TODO: Chris has to find a better solution ;-) -->
<script src="/js/vendor/adyen.encrypt.min.js"></script>
<!-- End of todo -->
